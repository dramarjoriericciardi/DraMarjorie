<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PsiManager 360 - Dra. Marjorie Ricciardi</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <!-- Firebase (Tenta carregar, se falhar, o site continua) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin: 0 auto; height: 300px; max-height: 400px; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .nav-item.active { background-color: #e0f2fe; color: #0369a1; border-right: 4px solid #0284c7; }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 6px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden text-sm md:text-base">

    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-slate-200 hidden md:flex flex-col z-20 shadow-lg">
        <div class="p-6 border-b border-slate-100">
            <h1 class="text-xl font-bold text-slate-800">PsiManager<span class="text-sky-600">360</span></h1>
            <p class="text-xs text-slate-500 mt-1">Gest√£o Inteligente</p>
        </div>

        <div class="p-4 space-y-2">
            <button onclick="openImportModal()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-4 rounded-lg shadow-sm transition-colors flex items-center justify-center gap-2 text-sm">
                <span>üì•</span> Importar Lista
            </button>
            <button onclick="exportToCSV()" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow-sm transition-colors flex items-center justify-center gap-2 text-xs">
                <span>üìä</span> Baixar Excel
            </button>
        </div>
        
        <nav class="flex-1 overflow-y-auto py-2">
            <ul class="space-y-1">
                <li><button onclick="router('dashboard')" id="nav-dashboard" class="nav-item w-full text-left px-6 py-3 text-slate-600 hover:bg-slate-50 transition-colors flex items-center group active">üìä Vis√£o Geral</button></li>
                <li><button onclick="router('patients')" id="nav-patients" class="nav-item w-full text-left px-6 py-3 text-slate-600 hover:bg-slate-50 transition-colors flex items-center group">üë• Pacientes (360¬∞)</button></li>
                <li><button onclick="router('alerts')" id="nav-alerts" class="nav-item w-full text-left px-6 py-3 text-slate-600 hover:bg-slate-50 transition-colors flex items-center group">‚ö†Ô∏è Alertas</button></li>
            </ul>
        </nav>
        
        <div class="p-4 border-t border-slate-100 bg-slate-50 flex items-center">
            <div class="w-8 h-8 rounded-full bg-sky-100 flex items-center justify-center text-sky-700 font-bold relative">
                Dr
                <span id="conn-indicator" class="absolute bottom-0 right-0 w-3 h-3 bg-gray-400 border-2 border-white rounded-full"></span>
            </div>
            <div class="ml-3">
                <p class="text-sm font-medium text-slate-700">Dra. Marjorie</p>
                <p class="text-xs text-slate-500" id="conn-text">Verificando...</p>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        <header class="md:hidden bg-white border-b border-slate-200 p-4 flex justify-between items-center z-10">
            <h1 class="font-bold text-slate-800">PsiManager</h1>
            <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-2xl">‚ò∞</button>
        </header>

        <div id="mobile-menu" class="fixed inset-0 bg-slate-800 bg-opacity-90 z-50 hidden md:hidden flex flex-col justify-center items-center space-y-6">
            <button onclick="document.getElementById('mobile-menu').classList.add('hidden')" class="absolute top-4 right-4 text-white text-2xl">‚úï</button>
            <button onclick="openImportModal();" class="text-emerald-300 text-xl font-bold">üì• Importar Lista</button>
            <button onclick="router('dashboard');" class="text-white text-xl">Vis√£o Geral</button>
        </div>

        <div id="content-area" class="flex-1 overflow-y-auto p-4 md:p-8">
            <!-- DASHBOARD -->
            <section id="view-dashboard" class="fade-in space-y-6">
                <div class="mb-6"><h2 class="text-2xl font-bold text-slate-800">Painel de Controle</h2></div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-white p-5 rounded-lg border border-slate-200 shadow-sm"><div><p class="text-xs font-semibold text-slate-400 uppercase">Total</p><h3 class="text-3xl font-bold text-slate-700 mt-2" id="kpi-total">0</h3></div></div>
                    <div class="bg-white p-5 rounded-lg border-l-4 border-l-sky-500 shadow-sm"><div><p class="text-xs font-semibold text-slate-400 uppercase">Agendados</p><h3 class="text-3xl font-bold text-sky-600 mt-2" id="kpi-scheduled">0</h3></div></div>
                    <div class="bg-white p-5 rounded-lg border-l-4 border-l-amber-400 shadow-sm"><div><p class="text-xs font-semibold text-slate-400 uppercase">Fila (Pendente)</p><h3 class="text-3xl font-bold text-amber-600 mt-2" id="kpi-pending">0</h3></div></div>
                    <div class="bg-white p-5 rounded-lg border-l-4 border-l-slate-500 shadow-sm"><div><p class="text-xs font-semibold text-slate-400 uppercase">Inativos</p><h3 class="text-3xl font-bold text-slate-600 mt-2" id="kpi-inactive">0</h3></div></div>
                </div>

                <!-- Fila de Agendamento -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg overflow-hidden shadow-sm mt-6">
                    <div class="p-4 bg-amber-100 flex justify-between items-center"><h3 class="font-bold text-amber-900">üìù Fila de Agendamento</h3></div>
                    <div class="max-h-96 overflow-y-auto">
                        <table class="w-full text-left"><tbody id="scheduling-queue-body" class="text-sm divide-y divide-amber-100 bg-white"></tbody></table>
                        <div id="empty-queue-msg" class="p-8 text-center text-slate-400 hidden">Nenhum paciente pendente!</div>
                    </div>
                </div>

                <!-- Gr√°ficos -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="font-bold text-slate-700 mb-4">Status da Carteira</h3>
                        <div class="chart-container"><canvas id="chartStatus"></canvas></div>
                    </div>
                </div>
            </section>

            <!-- PACIENTES 360 -->
            <section id="view-patients" class="hidden fade-in space-y-6">
                <div class="flex justify-between items-end gap-4">
                    <h2 class="text-2xl font-bold text-slate-800">Pacientes (360¬∞)</h2>
                    <input type="text" id="patient-search" placeholder="üîç Buscar..." class="w-full md:w-64 px-4 py-2 border rounded-lg">
                </div>
                <div class="bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-slate-600 text-xs uppercase"><tr class="border-b"><th class="p-4">Paciente</th><th class="p-4">Retorno</th><th class="p-4">Situa√ß√£o</th><th class="p-4 text-right">A√ß√£o</th></tr></thead>
                            <tbody id="patients-table-body" class="text-sm divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                    <div class="p-4 bg-slate-50 text-xs text-slate-500"><span id="patient-count-footer">...</span></div>
                </div>
            </section>

            <!-- ALERTAS -->
            <section id="view-alerts" class="hidden fade-in space-y-8">
                <h2 class="text-2xl font-bold text-slate-800">Alertas</h2>
                <div class="bg-amber-50 rounded-lg border border-amber-200 p-6">
                    <h3 class="text-lg font-bold text-amber-800 mb-4">‚ö†Ô∏è Atraso de Retorno (> 30 Dias)</h3>
                    <div class="bg-white rounded border border-amber-100 overflow-hidden"><table class="w-full text-left"><tbody id="alert-30-body" class="text-sm"></tbody></table></div>
                </div>
            </section>
        </div>
    </main>

    <!-- MODAL IMPORTA√á√ÉO -->
    <div id="modal-import" class="fixed inset-0 bg-slate-900 bg-opacity-50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl flex flex-col max-h-[90vh]">
            <div class="bg-emerald-600 p-4 flex justify-between items-center rounded-t-lg">
                <h3 class="text-white font-bold text-lg">Importar Lista</h3>
                <button onclick="closeImportModal()" class="text-white text-2xl">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto flex-1">
                <textarea id="import-text" class="w-full h-48 border border-slate-300 rounded p-3 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Cole aqui: RETORNOS 03/12..."></textarea>
            </div>
            <div class="p-4 border-t flex justify-end gap-3">
                <button onclick="closeImportModal()" class="px-4 py-2 text-slate-600 rounded hover:bg-slate-100">Cancelar</button>
                <button onclick="processImport()" class="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 shadow">Processar</button>
            </div>
        </div>
    </div>

    <!-- SCRIPT PRINCIPAL -->
    <script>
        // --- 1. CONFIGURA√á√ÉO (Vari√°veis Globais) ---
        let patientData = [];
        let db = null;
        let isOnline = false;
        const TODAY = new Date();

        // Configura√ß√£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAJ8fwhLOrCjrJWEjTMWaWgcZYSY-p_hbA",
            authDomain: "psimanager-dramarjorie.firebaseapp.com",
            projectId: "psimanager-dramarjorie",
            storageBucket: "psimanager-dramarjorie.firebasestorage.app",
            messagingSenderId: "1056688238572",
            appId: "1:1056688238572:web:9cec66bcdaaf23d3b19ac9"
        };

        // --- 2. INICIALIZA√á√ÉO ROBUSTA (H√≠brida) ---
        function initSystem() {
            try {
                if (typeof firebase !== 'undefined') {
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    initCloudListener(); // Tenta conectar na nuvem
                } else {
                    throw new Error("Firebase n√£o carregou");
                }
            } catch (e) {
                console.warn("Modo Offline Ativado:", e);
                activateOfflineMode();
            }
            
            // Inicializa a UI mesmo se a nuvem falhar
            initUI();
        }

        function initCloudListener() {
            db.collection("pacientes").onSnapshot((querySnapshot) => {
                isOnline = true;
                patientData = [];
                querySnapshot.forEach((doc) => patientData.push({ id: doc.id, ...doc.data() }));
                updateConnectionStatus(true);
                renderAll();
                // Salva backup local silencioso
                localStorage.setItem('psi_backup_data', JSON.stringify(patientData));
            }, (error) => {
                console.error("Erro Nuvem:", error);
                activateOfflineMode();
            });
        }

        function activateOfflineMode() {
            isOnline = false;
            updateConnectionStatus(false);
            // Tenta carregar do backup local
            const localData = localStorage.getItem('psi_backup_data');
            if (localData) {
                patientData = JSON.parse(localData);
                renderAll();
                alert("Aten√ß√£o: Sem conex√£o com a nuvem. Usando dados salvos neste computador.");
            }
        }

        function updateConnectionStatus(online) {
            const dot = document.getElementById('conn-indicator');
            const text = document.getElementById('conn-text');
            if (online) {
                dot.className = "absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full";
                text.textContent = "Online ‚Ä¢ Nuvem";
            } else {
                dot.className = "absolute bottom-0 right-0 w-3 h-3 bg-orange-500 border-2 border-white rounded-full";
                text.textContent = "Offline ‚Ä¢ Local";
            }
        }

        // --- 3. L√ìGICA DE NEG√ìCIO ---

        // Importa√ß√£o
        function openImportModal() { document.getElementById('modal-import').classList.remove('hidden'); }
        function closeImportModal() { document.getElementById('modal-import').classList.add('hidden'); }

        async function processImport() {
            const text = document.getElementById('import-text').value;
            const lines = text.split('\n');
            let consultDate = null;
            let count = 0;

            // Busca Data (DD/MM/AAAA ou DD-MM-AAAA)
            const dateRegex = /(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})/;
            for(let i=0; i<5; i++) {
                if(lines[i] && dateRegex.test(lines[i])) {
                    const match = lines[i].match(dateRegex);
                    let year = parseInt(match[3]);
                    if (year < 100) year += 2000;
                    consultDate = new Date(year, parseInt(match[2])-1, parseInt(match[1]));
                    break;
                }
            }

            if (!consultDate) { alert("Data n√£o encontrada no topo do texto (ex: 03/12/2025)."); return; }

            // Regex de Linha
            const rowRegex = /^(\*?)(.*?)(?:[\.\s]*?)HD[:\s]+(.*?)(?:[\.\s]*?)RET(?:.*?)(?:EM)?\s+(.*?)\s*\((?:EM)?\s*(\d+)/i;

            for (const line of lines) {
                const match = line.trim().match(rowRegex);
                if (match) {
                    let name = match[2].trim();
                    const hasAsterisk = match[1] === '*';
                    
                    // L√≥gica de Retorno
                    let daysToAdd = 30;
                    if (match[4].toUpperCase().includes('M')) daysToAdd = (parseInt(match[4].replace(/\D/g,'')) || 1) * 30;
                    else if (match[4].toLowerCase().includes('D')) daysToAdd = parseInt(match[4].replace(/\D/g,'')) || 30;
                    
                    const returnDate = new Date(consultDate);
                    returnDate.setDate(returnDate.getDate() + daysToAdd);

                    const newData = {
                        lastConsult: dateToYYYYMMDD(consultDate),
                        returnDue: dateToYYYYMMDD(returnDate),
                        cid: match[3].trim(),
                        duration: parseInt(match[5]),
                        status: "Ativo",
                        schedulingStatus: "pendente"
                    };

                    await saveData(name, newData, hasAsterisk);
                    count++;
                }
            }
            closeImportModal();
            renderAll();
            alert(`${count} pacientes processados!`);
        }

        // Fun√ß√£o Inteligente de Salvar (H√≠brida)
        async function saveData(name, data, isNew) {
            // Normaliza nome para busca
            const cleanName = name.replace('*','').trim();
            
            if (isOnline && db) {
                // Modo Nuvem
                const query = await db.collection("pacientes").get();
                let docId = null;
                
                query.forEach(doc => {
                    if (doc.data().name.replace('*','').trim().toLowerCase() === cleanName.toLowerCase()) {
                        docId = doc.id;
                    }
                });

                if (docId) {
                    if (isNew && !name.includes('*')) name = "*" + name; // Mant√©m asterisco se existia
                    await db.collection("pacientes").doc(docId).update({ ...data, name: name });
                } else {
                    if (isNew) name = "*" + cleanName;
                    await db.collection("pacientes").add({ ...data, name: name });
                }
            } else {
                // Modo Offline (Local Array)
                let existing = patientData.find(p => p.name.replace('*','').trim().toLowerCase() === cleanName.toLowerCase());
                if (existing) {
                    Object.assign(existing, data);
                    if(isNew && !existing.name.includes('*')) existing.name = "*" + existing.name;
                } else {
                    if (isNew) name = "*" + cleanName;
                    patientData.push({ id: Date.now().toString(), name: name, ...data });
                }
                localStorage.setItem('psi_backup_data', JSON.stringify(patientData));
            }
        }

        async function updateStatus(id, newStatus, newScheduling) {
            if (isOnline && db) {
                await db.collection("pacientes").doc(id).update({ 
                    status: newStatus, 
                    schedulingStatus: newScheduling 
                });
            } else {
                const p = patientData.find(pat => pat.id === id);
                if (p) {
                    p.status = newStatus;
                    p.schedulingStatus = newScheduling;
                    localStorage.setItem('psi_backup_data', JSON.stringify(patientData));
                    renderAll();
                }
            }
        }

        // --- A√á√ïES UI ---
        function handleSchedule(id) {
            updateStatus(id, "Ativo", "agendado");
        }

        function handleUnschedule(id) {
            if(confirm("Paciente desmarcou? Volta para a fila.")) {
                updateStatus(id, "Ativo", "pendente");
                // Visual imediato
                setTimeout(() => router('dashboard'), 500);
            }
        }

        function handleDropout(id) {
            if(confirm("Mover para Inativos?")) {
                updateStatus(id, "Inativo", "pendente");
            }
        }

        // --- RENDERERS ---
        Chart.register(ChartDataLabels);

        function renderAll() {
            const searchTerm = document.getElementById('patient-search')?.value.toLowerCase() || "";
            
            // KPI
            const total = patientData.length;
            const scheduled = patientData.filter(p => p.schedulingStatus === 'agendado' && p.status !== 'Inativo').length;
            const pending = patientData.filter(p => p.schedulingStatus === 'pendente' && p.status !== 'Inativo').length;
            const inactive = patientData.filter(p => p.status === 'Inativo' || getDaysDiff(p.lastConsult) > 90).length;
            
            document.getElementById('kpi-total').textContent = total;
            document.getElementById('kpi-scheduled').textContent = scheduled;
            document.getElementById('kpi-pending').textContent = pending;
            document.getElementById('kpi-inactive').textContent = inactive;

            // Fila Dashboard
            const queueBody = document.getElementById('scheduling-queue-body');
            queueBody.innerHTML = '';
            const queue = patientData.filter(p => p.schedulingStatus === 'pendente' && p.status !== 'Inativo');
            
            if(queue.length === 0) {
                document.getElementById('empty-queue-msg').classList.remove('hidden');
                document.getElementById('empty-queue-msg').textContent = "Tudo em dia! üéâ";
            } else {
                document.getElementById('empty-queue-msg').classList.add('hidden');
                queue.forEach(p => {
                    queueBody.innerHTML += `<tr class="hover:bg-amber-50 border-b border-amber-100"><td class="p-3 font-medium">${p.name}</td><td class="p-3 text-slate-600">${formatDate(p.returnDue)}</td><td class="p-3 text-right"><button onclick="handleSchedule('${p.id}')" class="bg-emerald-500 text-white px-3 py-1 rounded shadow text-xs font-bold hover:bg-emerald-600">Agendar</button></td></tr>`;
                });
            }

            // Tabela 360
            const tableBody = document.getElementById('patients-table-body');
            tableBody.innerHTML = '';
            const filtered = patientData.filter(p => p.name.toLowerCase().includes(searchTerm));
            document.getElementById('patient-count-footer').textContent = `${filtered.length} pacientes`;

            filtered.forEach(p => {
                const daysAbsent = getDaysDiff(p.lastConsult);
                let displayStatus = p.status;
                if(daysAbsent > 90) displayStatus = "Inativo";
                
                let btn = p.schedulingStatus === 'agendado' 
                    ? `<button onclick="handleUnschedule('${p.id}')" class="text-rose-600 border border-rose-200 bg-rose-50 px-2 py-1 rounded text-xs hover:bg-rose-100 font-bold">‚ùå Desmarcou</button>`
                    : `<button onclick="handleSchedule('${p.id}')" class="text-emerald-600 border border-emerald-200 bg-emerald-50 px-2 py-1 rounded text-xs hover:bg-emerald-100 font-bold">‚úÖ Agendar</button>`;
                
                let statusClass = displayStatus === 'Ativo' ? 'bg-green-100 text-green-800' : 'bg-slate-200 text-slate-600';

                tableBody.innerHTML += `<tr class="border-b hover:bg-slate-50"><td class="p-4 font-medium">${p.name}<div class="text-xs text-slate-400">CID: ${p.cid}</div></td><td class="p-4 text-slate-600">${formatDate(p.returnDue)}</td><td class="p-4"><span class="px-2 py-1 rounded text-xs font-bold ${statusClass}">${displayStatus}</span></td><td class="p-4 text-right">${btn}</td></tr>`;
            });

            // Alertas
            const alertBody = document.getElementById('alert-30-body');
            alertBody.innerHTML = '';
            patientData.forEach(p => {
                const delay = getReturnDelay(p.returnDue);
                if (delay > 30 && p.schedulingStatus === 'pendente' && p.status !== 'Inativo') {
                    alertBody.innerHTML += `<tr class="border-b hover:bg-amber-50"><td class="p-3 font-medium">${p.name}</td><td class="p-3 text-slate-500">${formatDate(p.returnDue)}</td><td class="p-3 font-bold text-amber-600">${delay} dias atraso</td><td class="p-3 text-right"><button onclick="handleDropout('${p.id}')" class="text-xs bg-rose-100 text-rose-700 px-2 py-1 rounded font-bold hover:bg-rose-200">Desist√™ncia</button></td></tr>`;
                }
            });

            updateChart(scheduled, pending, inactive);
        }

        // Charts
        let myChart = null;
        function updateChart(sched, pend, inact) {
            const ctx = document.getElementById('chartStatus').getContext('2d');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: ['Agendados', 'Pendente', 'Inativos'], datasets: [{ data: [sched, pend, inact], backgroundColor: ['#0ea5e9', '#f59e0b', '#64748b'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }

        // Utils
        function dateToYYYYMMDD(d) { return d.toISOString().split('T')[0]; }
        function formatDate(s) { if(!s) return '-'; const [y,m,d] = s.split('-'); return `${d}/${m}/${y}`; }
        function getDaysDiff(s) { if(!s) return 999; return Math.ceil((TODAY - new Date(s))/(1000*60*60*24)); }
        function getReturnDelay(s) { if(!s) return 0; return Math.ceil((TODAY - new Date(s))/(1000*60*60*24)); }
        function exportToCSV() { 
            const content = "data:text/csv;charset=utf-8," + ["ID,Nome,Ultima,Retorno,Status"].join(",") + "\n" + patientData.map(p => [p.id, p.name, p.lastConsult, p.returnDue, p.status].join(",")).join("\n");
            const link = document.createElement("a"); link.href = encodeURI(content); link.download = "pacientes.csv"; document.body.appendChild(link); link.click();
        }

        // Router
        function router(view) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('view-'+view).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('nav-'+view).classList.add('active');
            if(window.innerWidth < 768) document.getElementById('mobile-menu').classList.add('hidden');
        }

        function initUI() {
            document.getElementById('patient-search').addEventListener('keyup', renderAll);
            router('dashboard'); // Force start
        }

        // Boot
        window.addEventListener('DOMContentLoaded', initSystem);

    </script>
</body>
</html>